{% extends 'base.html.twig' %}

{% block title %}Configuración ARCA | ItaStock{% endblock %}

{% block body %}
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h1 class="h4 mb-1">Configuración ARCA</h1>
            <p class="text-muted mb-0">Configurá los datos de facturación y realizá pruebas de conexión.</p>
        </div>
    </div>

    <div class="card shadow-sm mb-4">
        <div class="card-body">
            {{ form_start(form) }}
                <div class="alert alert-info small mb-3">
                    No se guardan archivos: se leen y se guardan como texto PEM en la configuración del comercio.
                </div>
                <div class="row g-3">
                    <div class="col-lg-4">
                        {{ form_row(form.arcaEnabled) }}
                    </div>
                    <div class="col-lg-4">
                        {{ form_row(form.arcaEnvironment) }}
                    </div>
                    <div class="col-lg-4">
                        {{ form_row(form.taxPayerType) }}
                    </div>
                    <div class="col-lg-6">
                        {{ form_row(form.cuitEmisor) }}
                    </div>
                    <div class="col-lg-6">
                        {{ form_row(form.passphrase) }}
                    </div>
                    <div class="col-lg-6">
                        {{ form_row(form.certFile, {
                            help: 'Subí el archivo .crt/.pem'
                        }) }}
                    </div>
                    <div class="col-lg-6">
                        {{ form_row(form.keyFile, {
                            help: 'Subí el archivo .key/.pem'
                        }) }}
                    </div>
                    <div class="col-12">
                        <div class="text-muted small">Si subís archivos, no hace falta pegar el contenido.</div>
                    </div>
                    <div class="col-lg-6">
                        <div class="text-muted small mb-1">Alternativa manual: pegá el PEM completo.</div>
                        {{ form_row(form.certPem) }}
                    </div>
                    <div class="col-lg-6">
                        <div class="text-muted small mb-1">Alternativa manual: pegá el PEM completo.</div>
                        {{ form_row(form.privateKeyPem) }}
                    </div>
                </div>

                <div class="d-flex justify-content-end gap-2 mt-4">
                    <button class="btn btn-primary">Guardar</button>
                </div>
            {{ form_end(form) }}
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <h2 class="h6">Probar conexión</h2>
            <p class="text-muted">Verificá que la comunicación con ARCA esté funcionando correctamente.</p>
            <form method="post" action="{{ path('app_settings_arca_test') }}">
                <input type="hidden" name="_token" value="{{ csrf_token('arca_test') }}">
                <button class="btn btn-outline-primary">Probar conexión</button>
            </form>
        </div>
    </div>
{% endblock %}
