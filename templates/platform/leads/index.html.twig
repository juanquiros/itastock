{% extends 'platform/base_platform.html.twig' %}

{% block header_title %}Leads{% endblock %}

{% block body %}
    <form method="get" class="row g-2 align-items-end mb-3">
        <div class="col-md-4">
            <label class="form-label">Email contiene</label>
            <input type="text" name="email" value="{{ filters.email }}" class="form-control">
        </div>
        <div class="col-md-3">
            <label class="form-label">Desde</label>
            <input type="date" name="from" value="{{ filters.from }}" class="form-control">
        </div>
        <div class="col-md-3">
            <label class="form-label">Hasta</label>
            <input type="date" name="to" value="{{ filters.to }}" class="form-control">
        </div>
        <div class="col-md-2 d-grid">
            <button class="btn btn-outline-primary" type="submit">Filtrar</button>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table align-middle">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Teléfono</th>
                    <th>Fuente</th>
                    <th>Mensaje</th>
                    <th>Estado</th>
                    <th class="text-end">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for lead in leads %}
                    <tr>
                        <td>{{ lead.createdAt|date('Y-m-d H:i') }}</td>
                        <td>{{ lead.name }}</td>
                        <td>{{ lead.email }}</td>
                        <td>{{ lead.phone ?: '—' }}</td>
                        <td>{{ lead.source ?: 'web' }}</td>
                        <td>{{ lead.message|slice(0, 40) ~ (lead.message|length > 40 ? '…' : '') }}</td>
                        <td>
                            {% if lead.isArchived %}
                                {{ lead.source == 'demo' ? 'Demo creada' : 'Archivado' }}
                            {% elseif lead.source == 'demo' %}
                                Demo pendiente
                            {% else %}
                                Activo
                            {% endif %}
                        </td>
                        <td class="text-end">
                            <a class="btn btn-sm btn-outline-primary" href="{{ path('platform_leads_show', {id: lead.id}) }}">Ver</a>
                            {% if not lead.isArchived %}
                                <form method="post" action="{{ path('platform_leads_index', app.request.query.all) }}" class="d-inline">
                                    <input type="hidden" name="archive" value="{{ lead.id }}">
                                    <button class="btn btn-sm btn-outline-secondary" type="submit">Archivar</button>
                                </form>
                            {% endif %}
                        </td>
                    </tr>
                {% else %}
                    <tr><td colspan="8">Sin leads.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}
