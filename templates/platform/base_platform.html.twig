<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{% block title %}Plataforma ItaStock{% endblock %}</title>
        <link rel="icon" type="image/svg+xml" href="{{ asset('brand/itastock-logo.svg') }}">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <style>
            body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
            .sidebar { min-height: 100vh; background: #0f172a; color: #fff; }
            .sidebar a { color: #cbd5e1; text-decoration: none; display: block; padding: 0.75rem 1rem; border-radius: 8px; }
            .sidebar a:hover, .sidebar a.active { background: rgba(255,255,255,0.08); color: #fff; }
        </style>
        {% block stylesheets %}{% endblock %}
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous" defer></script>
        <script src="{{ asset('vendor/html5-qrcode.min.js') }}" defer></script>
        {{ importmap('app') }}
        {% block javascripts %}{% endblock %}
    </head>
    <body>
        <div class="d-flex">
            <aside class="sidebar p-3">
                <div class="d-flex align-items-center gap-2 mb-4">
                    <img src="{{ asset('brand/itastock-logo.svg') }}" alt="ItaStock" width="32" height="32">
                    <div>
                        <div class="fw-bold">ItaStock</div>
                        <div class="small text-secondary">Plataforma</div>
                    </div>
                </div>
                {% set current = app.request.attributes.get('_route') %}
                <nav class="d-flex flex-column gap-1">
                    <a href="{{ path('platform_dashboard') }}" class="{{ current == 'platform_dashboard' ? 'active' : '' }}">Dashboard</a>
                    <a href="{{ path('platform_pages_index') }}" class="{{ current starts with 'platform_pages' ? 'active' : '' }}">Páginas públicas</a>
                    <a href="{{ path('platform_plans_index') }}" class="{{ current starts with 'platform_plans' ? 'active' : '' }}">Planes</a>
                    <a href="{{ path('platform_billing_plans_index') }}" class="{{ current starts with 'platform_billing_plans' ? 'active' : '' }}">Planes billing</a>
                    <a href="{{ path('platform_business_index') }}" class="{{ current starts with 'platform_business' ? 'active' : '' }}">Comercios</a>
                    <a href="{{ path('platform_settings_pos') }}" class="{{ current starts with 'platform_settings' ? 'active' : '' }}">Configuración POS</a>
                    <a href="{{ path('app_email_preferences') }}" class="{{ current == 'app_email_preferences' ? 'active' : '' }}">Preferencias de emails</a>
                    <div class="text-uppercase small text-secondary mt-3">Catálogo maestro</div>
                    <a href="{{ path('platform_catalog_category_index') }}" class="{{ current starts with 'platform_catalog_category' ? 'active' : '' }}">Categorías globales</a>
                    <a href="{{ path('platform_catalog_brand_index') }}" class="{{ current starts with 'platform_catalog_brand' ? 'active' : '' }}">Marcas globales</a>
                    <a href="{{ path('platform_catalog_product_index') }}" class="{{ current starts with 'platform_catalog_product' ? 'active' : '' }}">Productos globales</a>
                    <a href="{{ path('platform_leads_index') }}" class="{{ current starts with 'platform_leads' ? 'active' : '' }}">Leads</a>
                    <a href="{{ path('platform_subscriptions_index') }}" class="{{ current starts with 'platform_subscriptions' ? 'active' : '' }}">Suscripciones</a>
                    <a href="{{ path('platform_reports_index') }}" class="{{ current == 'platform_reports_index' ? 'active' : '' }}">Reportes</a>
                    <a href="{{ path('platform_reports_traffic') }}" class="{{ current == 'platform_reports_traffic' ? 'active' : '' }}">Tráfico (SEO)</a>
                    <a href="{{ path('platform_email_logs') }}" class="{{ current starts with 'platform_email_logs' ? 'active' : '' }}">Emails enviados</a>
                </nav>
            </aside>
            <main class="flex-grow-1 p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h1 class="h4 mb-0">{% block header_title %}Panel{% endblock %}</h1>
                        {% block header_subtitle %}{% endblock %}
                    </div>
                    <div class="text-end">
                        <div class="fw-semibold">{{ app.user.fullName ?? '' }}</div>
                        <div class="small text-muted">{{ app.user.email ?? '' }}</div>
                    </div>
                </div>

                {% for label, messages in app.flashes %}
                    {% for message in messages %}
                        <div class="alert alert-{{ label }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                        </div>
                    {% endfor %}
                {% endfor %}

                {% block body %}{% endblock %}
            </main>
        </div>
    </body>
</html>
