<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    {% set paperWidth = business.ticketPaperWidthMm ?? 80 %}
    <style>
        body { font-family: "Courier New", Courier, monospace; font-size: 11px; color: #000; }
        h1 { font-size: 16px; margin-bottom: 4px; }
        h2 { font-size: 12px; margin: 10px 0 4px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        th, td { border: 1px solid #000; padding: 3px 4px; }
        th { background: #fff; text-align: left; }
        .meta { margin-bottom: 12px; }
        .meta div { margin-bottom: 4px; }
        .totals { margin-top: 8px; text-align: right; }
        .legend { margin-top: 12px; font-size: 10px; color: #000; }
        .page {
            max-width: {{ paperWidth }}mm;
        }
    </style>
</head>
<body>
    <div class="page">
        <h1>Remito de venta</h1>

    <div class="meta">
        {% if business.ticketHeaderImagePath %}
            <div style="margin-bottom: 8px;">
                <img src="{{ business.ticketHeaderImagePath }}" alt="Icono del comercio" style="max-height: 120px; max-width: 100%;">
            </div>
        {% endif %}
        <div><strong>Comercio:</strong> {{ business.name }}</div>
        <div><strong>Fecha:</strong> {{ sale.createdAt|date('d/m/Y H:i') }}</div>
        <div><strong>N° de remito:</strong> {{ remitoNumber }}</div>
        <div><strong>Generado:</strong> {{ generatedAt|date('d/m/Y H:i') }}</div>
        <div><strong>Cliente:</strong> {{ sale.customer ? sale.customer.name : 'Consumidor Final' }}</div>
        {% set headerLines = business.ticketHeaderLines ? business.ticketHeaderLines|replace({'\r': ''})|split('\n') : [] %}
        {% if headerLines %}
            <div style="margin-top: 6px;">
                {% for line in headerLines %}
                    {% if line|trim %}
                        <div>{{ line }}</div>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <h2>Detalle de ítems</h2>
    <table>
        <thead>
            <tr>
                <th>Producto</th>
                <th style="text-align: right;">Cant.</th>
                <th style="text-align: right;">Precio</th>
                <th style="text-align: right;">Total</th>
            </tr>
        </thead>
        <tbody>
        {% for item in sale.items %}
            <tr>
                <td>{{ item.description }}</td>
                <td style="text-align: right;">{{ item.qty|number_format(3, '.', ',') }}</td>
                <td style="text-align: right;">${{ item.unitPrice }}</td>
                <td style="text-align: right;">${{ item.lineTotal }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <div class="totals">
        <div><strong>Total:</strong> ${{ sale.total }}</div>
    </div>

    <h2>Pagos</h2>
    <ul>
        {% for payment in sale.payments %}
            <li>{{ payment.method }} · ${{ payment.amount }}</li>
        {% else %}
            <li>Sin pagos registrados</li>
        {% endfor %}
    </ul>

    {% if sale.status == 'VOIDED' %}
        <p><strong>Estado:</strong> ANULADA</p>
        {% if sale.voidReason %}
            <p><strong>Motivo de anulación:</strong> {{ sale.voidReason }}</p>
        {% endif %}
    {% endif %}

    {% set footerLines = business.ticketFooterLines ? business.ticketFooterLines|replace({'\r': ''})|split('\n') : [] %}
    {% if footerLines %}
        <div style="margin-top: 8px;">
            {% for line in footerLines %}
                {% if line|trim %}
                    <div>{{ line }}</div>
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}

    {% if business.ticketFooterImagePath %}
        <div style="margin-top: 8px;">
            <img src="{{ business.ticketFooterImagePath }}" alt="Imagen final del ticket" style="max-height: 160px; max-width: 100%;">
        </div>
    {% endif %}

        <div class="legend">
            <strong>NO VÁLIDO COMO TICKET FISCAL</strong><br>
            Este documento actúa como remito no fiscal emitido desde ItaStock.
        </div>
    </div>
</body>
</html>
